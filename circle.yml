#basic setup
machine:
  timezone: Asia/Tokyo
  post:
    - wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64
    - sudo chmod +x ./jq
    - sudo cp jq /usr/bin
    - aws configure set preview.cloudfront true

# test
test:
  override:
    - echo "test"

# deploy
deployment:
  prod:
    branch: master
    commands:
      - targetBucketName=`echo vivo-sample-web`
      - domainName=`aws cloudfront get-distribution-config --id E2HVGXWAELHRMB | jq -r '.DistributionConfig .Origins .Items[0] .DomainName'`
      - echo $domainName
      - IFS='.' read -r currentBucketName string <<< "$domainName"
      - if echo $currentBucketName | grep -Eq "vivo-sample-web"; then targetBucketName=`echo vivo-sample-web-2`; fi
      - aws s3 sync project s3://$targetBucketName/ --delete
